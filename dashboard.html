<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Dashboard - NAEMSS eLibrary</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-Avb2QiuDEEvB4bZJYdft2mNjV8FJ0V7irTLQ8U0qcPxh4Plq7G5tGm0rU+1SPhVotteLpBERwTkw==" crossorigin="anonymous" />
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
    <style>
      body {
        font-family: 'Poppins', sans-serif;
      }

      /* Navbar styling */
      .navbar {
        background-color: #FFD700; /* Gold */
      }

      .dark .navbar {
        background-color: #B8860B; /* Dark gold */
      }

      /* Profile card styling */
      .profile-card {
        background: #FFFFFF; /* White for light mode */
        border-top: 4px solid #FFD700; /* Gold */
        transition: transform 0.3s ease;
      }

      .dark .profile-card {
        background: #1E293B; /* Deep slate for dark mode */
        border-top: 4px solid #B8860B; /* Dark gold */
      }

      .profile-card:hover {
        transform: scale(1.05);
      }

      /* Profile picture styling */
      .profile-picture {
        width: 8rem; /* 128px */
        height: 8rem;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #FFD700; /* Gold border */
        cursor: pointer;
      }

      .dark .profile-picture {
        border: 2px solid #B8860B; /* Dark gold border */
      }

      /* Modal styling */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5); /* Backdrop */
        z-index: 100;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: #FFFFFF;
        border-top: 4px solid #FFD700;
        border-radius: 0.5rem;
        padding: 1.5rem;
        width: 90%;
        max-width: 28rem; /* 448px */
      }

      .dark .modal-content {
        background: #1E293B;
        border-top: 4px solid #B8860B;
      }

      /* Responsive adjustments */
      @media (max-width: 640px) {
        .desktop-title {
          display: none;
        }
        .mobile-title {
          display: inline;
        }
        .profile-picture {
          width: 6rem; /* 96px for mobile */
          height: 6rem;
        }
        .profile-card {
          padding: 1rem;
        }
        .modal-content {
          padding: 1rem;
          width: 95%;
        }
      }
      @media (min-width: 641px) {
        .desktop-title {
          display: inline;
        }
        .mobile-title {
          display: none;
        }
      }
    </style>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              poppins: ['Poppins', 'sans-serif']
            },
            colors: {
              gold: '#FFD700',
              darkgold: '#B8860B',
              softBlue: '#60A5FA',
              lightBlue: '#93C5FD',
              paleGreen: '#A7F3D0',
              deepSlate: '#1E293B'
            }
          }
        }
      }
    </script>
  </head>
  <body class="bg-gray-100 dark:bg-deepSlate text-gray-900 dark:text-white">
    <!-- Navbar -->
    <nav class="navbar p-4 shadow-md fixed w-full top-0 z-50">
      <div class="max-w-7xl mx-auto flex justify-between items-center">
        <h1 class="text-xl font-bold text-deepSlate dark:text-white">
          <span class="desktop-title">NAEMSS eLibrary</span>
          <span class="mobile-title">NAEMSS</span>
        </h1>
        <div class="flex items-center gap-4">
          <button id="logoutBtn" class="bg-gold dark:bg-darkgold text-white font-semibold py-2 px-4 rounded-md hover:bg-darkgold dark:hover:bg-gold transition duration-300">
            Log Out
          </button>
          <button id="toggleMenu" class="sm:hidden text-deepSlate dark:text-white focus:outline-none text-2xl">
            ☰
          </button>
        </div>
        <ul id="menu" class="hidden sm:flex gap-4">
          <li><a href="/index.html" class="text-deepSlate dark:text-white hover:underline">Home</a></li>
          <li><a href="/mcs.html" class="text-deepSlate dark:text-white hover:underline">Metrology & Climate Science</a></li>
          <li><a href="/agy.html" class="text-deepSlate dark:text-white hover:underline">Applied Geology</a></li>
          <li><a href="/signup.html" class="text-deepSlate dark:text-white hover:underline">Sign Up</a></li>
          <li><a href="/login.html" class="text-deepSlate dark:text-white hover:underline">Log In</a></li>
        </ul>
      </div>
    </nav>

    <!-- Mobile menu -->
    <div id="mobileMenu" class="sm:hidden hidden bg-gold dark:bg-darkgold px-4 py-2 space-y-2 mt-16">
      <a href="/index.html" class="block text-deepSlate dark:text-white py-2 hover:bg-lightBlue dark:hover:bg-softBlue rounded">Home</a>
      <a href="/mcs.html" class="block text-deepSlate dark:text-white py-2 hover:bg-lightBlue dark:hover:bg-softBlue rounded">Metrology & Climate Science</a>
      <a href="/agy.html" class="block text-deepSlate dark:text-white py-2 hover:bg-lightBlue dark:hover:bg-softBlue rounded">Applied Geology</a>
      <a href="/signup.html" class="block text-deepSlate dark:text-white py-2 hover:bg-lightBlue dark:hover:bg-softBlue rounded">Sign Up</a>
      <a href="/login.html" class="block text-deepSlate dark:text-white py-2 hover:bg-lightBlue dark:hover:bg-softBlue rounded">Log In</a>
    </div>

    <!-- Profile Picture Modal -->
    <div id="pictureModal" class="modal">
      <div class="modal-content">
        <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">Update Profile Picture</h3>
        <p id="pictureError" class="text-red-500 text-sm hidden mb-2"></p>
        <input
          type="text"
          id="pictureUrl"
          placeholder="Enter image URL (e.g., https://example.com/image.jpg)"
          class="p-2 rounded-md text-gray-900 dark:text-white bg-gray-100 dark:bg-gray-700 w-full mb-4 focus:outline-none focus:ring-2 focus:ring-gold dark:focus:ring-darkgold"
        />
        <div class="flex justify-end gap-2">
          <button id="cancelPictureBtn" class="bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600 transition">Cancel</button>
          <button id="submitPictureBtn" class="bg-deepSlate dark:bg-white dark:text-deepSlate text-white py-2 px-4 rounded-md hover:bg-gray-700 dark:hover:bg-gray-200 transition">Submit</button>
        </div>
      </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">Edit Profile</h3>
        <p id="editError" class="text-red-500 text-sm hidden mb-2"></p>
        <div class="space-y-4">
          <div>
            <label for="editName" class="block text-sm font-medium text-gray-800 dark:text-white">Name</label>
            <input
              type="text"
              id="editName"
              class="p-2 rounded-md text-gray-900 dark:text-white bg-gray-100 dark:bg-gray-700 w-full focus:outline-none focus:ring-2 focus:ring-gold dark:focus:ring-darkgold"
            />
          </div>
          <div>
            <label for="editMatric" class="block text-sm font-medium text-gray-800 dark:text-white">Matric Number</label>
            <input
              type="text"
              id="editMatric"
              class="p-2 rounded-md text-gray-900 dark:text-white bg-gray-100 dark:bg-gray-700 w-full focus:outline-none focus:ring-2 focus:ring-gold dark:focus:ring-darkgold"
            />
          </div>
          <div>
            <label for="editEmail" class="block text-sm font-medium text-gray-800 dark:text-white">Email</label>
            <input
              type="email"
              id="editEmail"
              class="p-2 rounded-md text-gray-900 dark:text-white bg-gray-100 dark:bg-gray-700 w-full focus:outline-none focus:ring-2 focus:ring-gold dark:focus:ring-darkgold"
            />
          </div>
        </div>
        <div class="flex justify-end gap-2 mt-4">
          <button id="cancelEditBtn" class="bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600 transition">Cancel</button>
          <button id="submitEditBtn" class="bg-deepSlate dark:bg-white dark:text-deepSlate text-white py-2 px-4 rounded-md hover:bg-gray-700 dark:hover:bg-gray-200 transition">Submit</button>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <section class="max-w-7xl mx-auto py-10 px-4 mt-16">
      <h2 class="text-3xl font-semibold mb-6 text-gold dark:text-darkgold">User Dashboard</h2>
      <p class="text-gray-600 dark:text-gray-300 text-sm mb-6">Manage your profile and explore NAEMSS eLibrary tools.</p>

      <!-- User Profile -->
      <div class="mb-8">
        <h3 class="text-xl font-semibold text-gold dark:text-darkgold mb-4">User Profile</h3>
        <div class="profile-card rounded-lg p-6 shadow-md text-center">
          <img id="userPicture" src="https://via.placeholder.com/128" alt="User Profile Picture" class="profile-picture mx-auto mb-4" />
          <div class="text-left max-w-sm mx-auto">
            <p><span class="font-bold text-gray-800 dark:text-white">Name:</span> <span id="userName">Loading...</span></p>
            <p><span class="font-bold text-gray-800 dark:text-white">Matric Number:</span> <span id="userMatric">Loading...</span></p>
            <p><span class="font-bold text-gray-800 dark:text-white">Email:</span> <span id="userEmail">Loading...</span></p>
            <button id="editProfileBtn" class="mt-4 text-gold dark:text-darkgold hover:text-softBlue dark:hover:text-lightBlue">
              <i class="fas fa-pencil-alt mr-2"></i>Edit Profile
            </button>
          </div>
        </div>
      </div>

      <!-- Student Tools -->
      <section class="max-w-7xl mx-auto py-10 px-4">
        <h2 class="text-2xl font-semibold mb-6 text-gold dark:text-darkgold">Student Tools</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
          <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center transform hover:scale-105 transition duration-300 border-t-4 border-gold dark:border-darkgold">
            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-2">NAEMSS Scientific Calculator</h3>
            <p class="text-gray-600 dark:text-gray-300 text-sm">A specialized calculator for NAEMSS students, supporting advanced geoscience calculations like mineral density and seismic wave velocity. Currently under development, it will integrate unit conversions and statistical tools for fieldwork. Check back for updates!</p>
          </div>
          <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center transform hover:scale-105 transition duration-300 border-t-4 border-gold dark:border-darkgold">
            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-2">NAEMSS GeoMap Studio</h3>
            <p class="text-gray-600 dark:text-gray-300 text-sm">An all-in-one mapping tool for NAEMSS students to create geological maps and analyze spatial data. This tool, under development, will support importing field data and visualizing geological features. Stay tuned for its release!</p>
          </div>
          <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center transform hover:scale-105 transition duration-300 border-t-4 border-gold dark:border-darkgold">
            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-2">NAEMSS Grapher</h3>
            <p class="text-gray-600 dark:text-white text-sm"><a href="/naemss-grapher.html" class="underline hover:text-gold">Create interactive graphs</a> for geoscience data, including line, bar, and scatter plots, with support for mathematical functions and CSV imports. Ideal for visualizing climate trends or geological measurements.</p>
          </div>
          <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center transform hover:scale-105 transition duration-300 border-t-4 border-gold dark:border-darkgold">
            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-2">Citation Management Tools</h3>
            <p class="text-gray-600 dark:text-gray-300 text-sm"><a href="https://www.zotero.org/" class="underline hover:text-gold">Zotero</a> and <a href="https://www.mendeley.com/" class="underline hover:text-gold">Mendeley</a> help NAEMSS students organize research references for geoscience papers. Import citations from journals like GeoScienceWorld and generate bibliographies in APA or MLA formats.</p>
          </div>
          <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center transform hover:scale-105 transition duration-300 border-t-4 border-gold dark:border-darkgold">
            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-2">Study Planners</h3>
            <p class="text-gray-600 dark:text-gray-300 text-sm"><a href="https://www.notion.so/templates/study-planner" class="underline hover:text-gold">Notion study templates</a> allow NAEMSS students to organize coursework, track deadlines for geology labs, and plan study sessions. Customize templates to manage field trips and research projects efficiently.</p>
          </div>
          <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center transform hover:scale-105 transition duration-300 border-t-4 border-gold dark:border-darkgold">
            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-2">Collaboration Platforms</h3>
            <p class="text-gray-600 dark:text-gray-300 text-sm"><a href="https://www.notion.so/" class="underline hover:text-gold">Notion</a> and <a href="https://slack.com/" class="underline hover:text-gold">Slack</a> enable NAEMSS students to collaborate on group projects, share field data, and discuss research findings. Create shared workspaces for team assignments or study groups.</p>
          </div>
          <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center transform hover:scale-105 transition duration-300 border-t-4 border-gold dark:border-darkgold">
            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-2">Virtual Lab Simulations</h3>
            <p class="text-gray-600 dark:text-gray-300 text-sm"><a href="https://phet.colorado.edu/en/simulations/category/earth-science" class="underline hover:text-gold">PhET simulations</a> offer interactive geoscience labs for modeling rock cycles, plate tectonics, and climate systems. NAEMSS students can use these tools to practice concepts before field or lab work.</p>
          </div>
          <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center transform hover:scale-105 transition duration-300 border-t-4 border-gold dark:border-darkgold">
            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-2">Geoscience Glossary</h3>
            <p class="text-gray-600 dark:text-gray-300 text-sm"><a href="https://www.americangeosciences.org/glossary" class="underline hover:text-gold">AGI Glossary of Geology</a> provides definitions for key geoscience terms, from mineralogy to seismology. Essential for NAEMSS students studying for exams or writing research papers.</p>
          </div>
          <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center transform hover:scale-105 transition duration-300 border-t-4 border-gold dark:border-darkgold">
            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-2">Geological Mapping Software</h3>
            <p class="text-gray-600 dark:text-gray-300 text-sm"><a href="https://qgis.org/" class="underline hover:text-gold">QGIS</a> and <a href="https://www.google.com/earth/" class="underline hover:text-gold">Google Earth Pro</a> enable NAEMSS students to create and analyze geological maps. Import field data to visualize fault lines, rock formations, or mineral deposits.</p>
          </div>
          <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center transform hover:scale-105 transition duration-300 border-t-4 border-gold dark:border-darkgold">
            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-2">Geophysical Data Analysis</h3>
            <p class="text-gray-600 dark:text-gray-300 text-sm"><a href="https://obspy.org/" class="underline hover:text-gold">ObsPy</a> is a Python library for NAEMSS students to analyze seismic and geophysical data. Process earthquake data or model wave propagation for research or coursework.</p>
          </div>
        </div>
      </section>

      <p id="errorMessage" class="text-red-500 text-center hidden">An error occurred. Please try again.</p>
    </section>

    <!-- Footer -->
    <footer class="bg-gold dark:bg-darkgold text-deepSlate dark:text-white pt-10 px-4">
      <div class="max-w-7xl mx-auto grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
        <div>
          <h3 class="text-lg font-semibold mb-4">Subscribe to Our Newsletter</h3>
          <div class="flex flex-col space-y-3">
            <input
              type="email"
              name="email"
              placeholder="Your email"
              class="p-2 rounded-md text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-darkgold dark:focus:ring-gold w-full"
              required
            />
            <button
              type="button"
              id="submit"
              class="bg-deepSlate dark:bg-white dark:text-deepSlate text-white font-semibold py-2 px-4 rounded-md hover:bg-gray-700 dark:hover:bg-gray-200 transition"
            >
              Subscribe
            </button>
          </div>
        </div>
        <div>
          <h3 class="text-lg font-semibold mb-4">Quick Links</h3>
          <ul class="space-y-2">
            <li><a href="/index.html" class="hover:underline">Home</a></li>
            <li><a href="/about.html" class="hover:underline">About Us</a></li>
            <li><a href="/terms.html" class="hover:underline">Terms & Conditions</a></li>
            <li><a href="/privacy.html" class="hover:underline">Privacy Policy</a></li>
          </ul>
        </div>
        <div>
          <h3 class="text-lg font-semibold mb-4">Contact Us</h3>
          <ul class="space-y-2">
            <li>Email: <a href="mailto:info@naemsslibrary.com" class="hover:underline">info@naemsslibrary.com</a></li>
            <li>Phone: <a href="tel:+2341234567890" class="hover:underline">+234 123 456 7890</a></li>
            <li>Address: NAEMSS Secretariat, University Campus</li>
          </ul>
        </div>
        <div>
          <h3 class="text-lg font-semibold mb-4">Follow Us</h3>
          <div class="flex gap-4">
            <a href="#" class="text-deepSlate dark:text-white hover:text-softBlue dark:hover:text-lightBlue"><i class="fab fa-facebook-f"></i></a>
            <a href="#" class="text-deepSlate dark:text-white hover:text-softBlue dark:hover:text-lightBlue"><i class="fab fa-twitter"></i></a>
            <a href="#" class="text-deepSlate dark:text-white hover:text-softBlue dark:hover:text-lightBlue"><i class="fab fa-instagram"></i></a>
            <a href="#" class="text-deepSlate dark:text-white hover:text-softBlue dark:hover:text-lightBlue"><i class="fab fa-linkedin-in"></i></a>
          </div>
        </div>
      </div>
      <div class="text-center py-6 mt-8 border-t border-deepSlate/20 dark:border-white/20">
        <p>&copy; 2025 NAEMSS eLibrary. All rights reserved.</p>
      </div>
    </footer>

    <script>
      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBAxpD6750L0WkCUIMTs5k7qqygCVzl4xQ",
        authDomain: "naemss-elibary.firebaseapp.com",
        projectId: "naemss-elibary",
        storageBucket: "naemss-elibary.firebasestorage.app",
        messagingSenderId: "978697395651",
        appId: "1:978697395651:web:954a5c3b29f4fc7c37b176",
        measurementId: "G-72WG3MPKPL"
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();

      // DOM elements
      const pictureModal = document.getElementById('pictureModal');
      const editModal = document.getElementById('editModal');
      const userPicture = document.getElementById('userPicture');
      const pictureUrlInput = document.getElementById('pictureUrl');
      const submitPictureBtn = document.getElementById('submitPictureBtn');
      const cancelPictureBtn = document.getElementById('cancelPictureBtn');
      const editProfileBtn = document.getElementById('editProfileBtn');
      const editNameInput = document.getElementById('editName');
      const editMatricInput = document.getElementById('editMatric');
      const editEmailInput = document.getElementById('editEmail');
      const submitEditBtn = document.getElementById('submitEditBtn');
      const cancelEditBtn = document.getElementById('cancelEditBtn');
      const pictureError = document.getElementById('pictureError');
      const editError = document.getElementById('editError');

      // Mobile menu toggle
      const toggleMenu = document.getElementById('toggleMenu');
      const mobileMenu = document.getElementById('mobileMenu');
      toggleMenu.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
        toggleMenu.textContent = mobileMenu.classList.contains('hidden') ? '☰' : '✕';
      });

      // Modal toggle functions
      function openModal(modal) {
        modal.style.display = 'flex';
      }

      function closeModal(modal) {
        modal.style.display = 'none';
        pictureError.classList.add('hidden');
        editError.classList.add('hidden');
        pictureUrlInput.value = '';
        editNameInput.value = '';
        editMatricInput.value = '';
        editEmailInput.value = '';
      }

      // Open modals
      userPicture.addEventListener('click', () => {
        pictureUrlInput.value = userPicture.src;
        openModal(pictureModal);
      });

      editProfileBtn.addEventListener('click', () => {
        editNameInput.value = document.getElementById('userName').textContent;
        editMatricInput.value = document.getElementById('userMatric').textContent;
        editEmailInput.value = document.getElementById('userEmail').textContent;
        openModal(editModal);
      });

      // Close modals
      cancelPictureBtn.addEventListener('click', () => closeModal(pictureModal));
      cancelEditBtn.addEventListener('click', () => closeModal(editModal));

      // User authentication state
      auth.onAuthStateChanged((user) => {
        if (user) {
          // User is signed in
          const displayName = user.displayName || 'Unknown';
          const email = user.email || 'Unknown';
          // Matric number requires Firestore; using placeholder
          const matricNumber = user.matricNumber || 'Not set';
          const photoURL = user.photoURL || 'https://via.placeholder.com/128';
          document.getElementById('userName').textContent = displayName;
          document.getElementById('userMatric').textContent = matricNumber;
          document.getElementById('userEmail').textContent = email;
          document.getElementById('userPicture').src = photoURL;
        } else {
          // No user is signed in, redirect to login
          window.location.href = '/login.html';
        }
      });

      // Update profile picture
      submitPictureBtn.addEventListener('click', () => {
        const url = pictureUrlInput.value.trim();
        const urlPattern = /^https?:\/\/.*\.(?:jpg|jpeg|png|gif)$/i;
        if (!url || !urlPattern.test(url)) {
          pictureError.textContent = 'Please enter a valid image URL (e.g., https://example.com/image.jpg)';
          pictureError.classList.remove('hidden');
          return;
        }

        const user = auth.currentUser;
        if (user) {
          firebase.auth().currentUser.updateProfile({ photoURL: url })
            .then(() => {
              userPicture.src = url;
              closeModal(pictureModal);
              alert('Profile picture updated successfully!');
            })
            .catch((error) => {
              pictureError.textContent = `Error: ${error.message}`;
              pictureError.classList.remove('hidden');
            });
        }
      });

      // Update profile details
      submitEditBtn.addEventListener('click', () => {
        const name = editNameInput.value.trim();
        const matric = editMatricInput.value.trim();
        const email = editEmailInput.value.trim();
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        if (!name || !email || !emailPattern.test(email)) {
          editError.textContent = 'Please enter a valid name and email address.';
          editError.classList.remove('hidden');
          return;
        }

        const user = auth.currentUser;
        if (user) {
          Promise.all([
            firebase.auth().currentUser.updateProfile({ displayName: name }),
            firebase.auth().currentUser.updateEmail(email)
          ])
            .then(() => {
              document.getElementById('userName').textContent = name;
              document.getElementById('userEmail').textContent = email;
              // Matric number update requires Firestore
              document.getElementById('userMatric').textContent = matric || 'Not set';
              console.log('Matric number update requires Firestore integration:', matric);
              closeModal(editModal);
              alert('Profile updated successfully!');
            })
            .catch((error) => {
              editError.textContent = `Error: ${error.message}`;
              editError.classList.remove('hidden');
            });
        }
      });

      // Logout functionality
      document.getElementById('logoutBtn').addEventListener('click', () => {
        auth.signOut()
          .then(() => {
            alert('Logged out successfully!');
            window.location.href = '/login.html';
          })
          .catch((error) => {
            document.getElementById('errorMessage').textContent = `Error: ${error.message}`;
            document.getElementById('errorMessage').classList.remove('hidden');
          });
      });

      // Subscription form
      document.getElementById('submit').addEventListener('click', () => {
        const emailInput = document.querySelector('input[name="email"]');
        if (emailInput.value) {
          alert('Subscribed successfully!');
          emailInput.value = '';
        } else {
          alert('Please enter a valid email address.');
        }
      });
    </script>
  </body>
</html>